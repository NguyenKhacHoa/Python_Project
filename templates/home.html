<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Reviewer - Dashboard</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">

    <style>
        /* CSS n·ªôi b·ªô gi·ªØ nguy√™n cho b·∫£ng l·ªãch s·ª≠ */
        .history-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        .history-table th { text-align: left; padding: 10px; color: #6b7280; font-weight: 500; border-bottom: 1px solid #e5e7eb; }
        .history-table td { padding: 12px 10px; border-bottom: 1px solid #f3f4f6; color: #374151; }
        .history-table tr:last-child td { border-bottom: none; }
        .score-badge { padding: 4px 8px; border-radius: 6px; font-weight: 600; font-size: 12px; }
        .score-good { background: #d1fae5; color: #059669; }
        .score-bad { background: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <aside class="sidebar">
            <div class="brand">
                <div class="logo-icon"><i class="fa-brands fa-connectdevelop"></i></div>
                <span>Code Reviewer</span>
            </div>

            <nav class="nav-menu">
                <div class="menu-label">MENU</div>
                <a href="#" class="nav-item active">
                    <i class="fa-solid fa-code"></i>Ph√¢n T√≠ch Code
                </a>

                {% if role == 'admin' %}
                    <a href="{{ url_for('admin_dashboard') }}" class="nav-item" style="color: #e67e22;">
                    <i class="fa-solid fa-users-gear"></i>Qu·∫£n L√Ω Users
                    </a>
                {% endif %}

                <a href="{{ url_for('history_page') }}" class="nav-item">
                    <i class="fa-solid fa-clock-rotate-left"></i>L·ªãch S·ª≠ Review
                </a>
                <a href="{{ url_for('settings') }}" class="nav-item">
                    <i class="fa-solid fa-gear"></i>C√†i ƒê·∫∑t
                </a>
            </nav>

            <div class="user-panel">
                <div class="avatar">{{ username[0]|upper }}</div>
                <div class="info">
                    <strong>{{ username }}</strong>
                    <span>{{ role|upper }}</span>
                </div>
                <a href="{{ url_for('logout') }}" class="btn-logout" title="ƒêƒÉng xu·∫•t">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <header class="header">
                <div>
                    <h2>Xin ch√†o, {{ username }}! üëã</h2>
                    <p class="text">S·ª≠ d·ª•ng AI ƒë·ªÉ ph√°t hi·ªán l·ªói b·∫£o m·∫≠t, r·ªßi ro v√† ƒë·ªÅ xu·∫•t code t·ªëi ∆∞u.</p>
                </div>
                <div class="actions">
                    <input type="file" id="file-upload" style="display: none;" accept=".py,.js,.java,.cpp,.c,.txt,.html,.css">

                    <label for="file-upload" class="btn-second" style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        <i class="fa-solid fa-upload"></i> T·∫£i File L√™n
                    </label>

                    <button class="btn-second" onclick="clearCode()">
                        <i class="fa-solid fa-eraser"></i> X√≥a
                    </button>

                    <button class="btn-primary" onclick="analyzeCode()">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> Ch·∫°y Ph√¢n T√≠ch
                    </button>
                </div>
            </header>

            <div class="stat-container">
                <div class="stat-card">
                   <div class="icon-box purple"><i class="fa-solid fa-bug"></i></div>
                    <div class="stat-info">
                        <h3 id="stat-bugs">0</h3>
                        <span>R·ªßi ro ti·ªÅm ·∫©n</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="icon-box green"><i class="fa-solid fa-chart-line"></i></div>
                    <div class="stat-info">
                        <h3 id="stat-score">--</h3>
                        <span>ƒêi·ªÉm ch·∫•t l∆∞·ª£ng</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="icon-box red"><i class="fa-solid fa-shield-halved"></i></div>
                    <div class="stat-info">
                        <h3 id="stat-security">0</h3>
                        <span>L·ªó h·ªïng b·∫£o m·∫≠t</span>
                    </div>
                </div>
            </div>

            <div class="workspace">
                <div class="panel code-panel">
                    <div class="panel-head">
                        <span class="panel-title">
                            <i class="fa-solid fa-file-code"></i> Source Code Input
                        </span>
                        <span class="badge">Python</span>
                    </div>
                    <textarea id="code-input" placeholder="# D√°n ƒëo·∫°n code PR c·ªßa Junior v√†o ƒë√¢y ƒë·ªÉ review..."></textarea>
                </div>

                <div class="panel result-panel">
                    <div class="panel-head">
                        <span class="panel-title">
                            <i class="fa-solid fa-robot"></i> K·∫øt qu·∫£ t·ª´ AI
                        </span>
                        <span id="status-text" class="status-waiting">S·∫µn s√†ng</span>
                    </div>
                    <div class="output-body" id="output-container">
                        <div id="view-empty" class="view-state">
                            <div class="empty-img"><i class="fa-solid fa-code-branch"></i></div>
                            <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
                            <span style="font-size:13px; color:#9ca3af">Vui l√≤ng nh·∫≠p code ho·∫∑c upload file</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="history-section" class="panel" style="margin-top: 24px; height: auto;">
                <div class="panel-head">
                    <span class="panel-title">
                        <i class="fa-solid fa-clock-rotate-left"></i> L·ªãch S·ª≠ Review G·∫ßn ƒê√¢y
                    </span>
                </div>
                <div style="padding: 0 20px 20px 20px;">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Th·ªùi gian</th>
                                <th>ƒêi·ªÉm s·ªë</th>
                                <th>T√≥m t·∫Øt t·ª´ AI</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in history %}
                            <tr>
                                <td>{{ item.created_at }}</td>
                                <td>
                                    <span class="score-badge {{ 'score-good' if item.score >= 80 else 'score-bad' }}">
                                        {{ item.score }}/100
                                    </span>
                                </td>
                                <td>{{ item.ai_summary }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" style="text-align:center; color:#9ca3af; padding: 20px;">
                                    Ch∆∞a c√≥ l·ªãch s·ª≠ review n√†o.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/home.js') }}"></script>
</body>
</html>